{% extends '@XutimCore/admin/base.html.twig' %}

{% block pageTitle %}{{ 'Translation revisions'|trans({}, 'admin')|capitalize }}{% endblock %}

{% block body %}
    <style>
        del {
            color: red;
        }

        ins {
            color: green;
        }
    </style>
    <div class="row">
        <div class="col-md-3">
            {% if form is defined and events is defined %}
                {{ form_start(form) }}
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Revisions</h3>
                    </div>
                    <div class="card-header py-2 ps-2">
                        Select the version to compare
                    </div>
                    <table
                        class="card-table table table-sm table-bordered table-vcenter table-responsive"
                    >
                        <tbody>
                            {% set eventsCnt = events|length %}
                            {% for key, event in events|reverse %}
                                <tr>
                                    <td>{{ eventsCnt - key }}</td>
                                    <td>
                                        <input
                                            type="radio"
                                            name="{{ form.revision_version.vars.full_name }}"
                                            id="{{ form.revision_version.vars.id }}"
                                            value="{{ event.id }}"
                                            {% if form.revision_version.vars.value == event.id or (not isSubmitted and loop.first) %}checked{% endif %}
                                        />
                                    </td>
                                    <td>
                                        <input
                                            type="radio"
                                            name="{{ form.revision_diff.vars.full_name }}"
                                            id="{{ form.revision_diff.vars.id }}"
                                            value="{{ event.id }}"
                                            {% if form.revision_diff.vars.value == event.id or (not isSubmitted and loop.index == 2) %}checked{% endif %}
                                        />
                                    </td>
                                    <td>
                                        {{ event.recordedAt|date('d M Y H:i') }}
                                    </td>
                                    <td>
                                        {{ usernames[event.userIdentifier].name is defined ? usernames[event.userIdentifier].name : event.userIdentifier }}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="card-footer text-end py-3">
                        <twig:Xutim:Admin:Button
                            variant="default"
                            class="btn-sm text-end"
                            type="submit"
                            >Show revisions</twig:Xutim:Admin:Button
                        >
                    </div>
                </div>
                {{ form_end(form, {render_rest: false}) }}
            {% else %}
                <div class="alert alert-warning" role="alert">
                    <h4 class="alert-title">No revision</h4>
                    <div class="text-secondary">
                        There is no revision to compare.
                    </div>
                </div>
            {% endif %}
        </div>
        <div class="col-md-9">
            <h2>Title</h2>
            {% if titleDiff is defined %}
                {{ titleDiff|raw }}
            {% else %}
                {{ translation.title }}
            {% endif %}

            <h2 class="mt-4">Description</h2>
            {% if descriptionDiff is defined %}
                {{ descriptionDiff|raw }}
            {% else %}
                {{ translation.description }}
            {% endif %}

            <h2 class="mt-4">Content</h2>
            {% if contentDiff is defined %}
                {{ contentDiff|raw }}
            {% else %}
                <p>{{ translation.content }}</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
