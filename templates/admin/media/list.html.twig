{% extends '@XutimCore/admin/base.html.twig' %}

{% block pageTitle %}
    <h2 class="pageTitle">
        {% if currentFolder %}
            {{ currentFolder.name }}
        {% else %}
            {{ 'Media library'|trans({}, 'admin') }}
        {% endif %}
    </h2>
{% endblock %}

{% block breadcrumbHeader %}
    <twig:Xutim:Admin:Breadcrumbs>
        <li class="breadcrumb-item">
            <a href="{{ admin_path('admin_media_list') }}">{{
                'Media'|trans({}, 'admin')
            }}</a>
        </li>

        {% for f in currentFolder.folderPath|default([]) %}
            {% if not loop.last %}
                <li class="breadcrumb-item">
                    <a
                        href="{{ admin_path('admin_media_list', {id: f.id}) }}"
                    >{{ f.name }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if currentFolder %}
            <li class="breadcrumb-item active" aria-current="page">
                {{ currentFolder.name }}
            </li>
        {% endif %}
    </twig:Xutim:Admin:Breadcrumbs>
{% endblock %}

{% block pageMenu %}
    <div class="d-flex align-items-center">
        <div class="me-3 align-items-center">
            <div class="input-icon">
                <form method="GET" action="" data-controller="auto-submit">
                    <input
                        type="text"
                        id="searchTerm"
                        name="searchTerm"
                        autofocus
                        class="form-control"
                        aria-label="{{ 'search'|trans({}, 'admin')|capitalize }}"
                        value="{{ app.request.get('searchTerm') }}"
                        data-action="auto-submit#debouncedSubmit"
                        onfocus="var temp_value=this.value; this.value=''; this.value=temp_value"
                    />
                    <span class="input-icon-addon">
                        <twig:Xutim:Admin:Icon name="search" />
                    </span>
                </form>
            </div>
        </div>
    </div>
    <twig:Xutim:Admin:Button
        tag="a"
        variant="nav"
        data-turbo-frame="modal"
        href="{{ admin_path('admin_media_folder_new', {id: currentFolder.id|default(null)}) }}"
    >
        <twig:Xutim:Admin:Icon name="folder" class="me-1" />
        {{ 'New folder'|trans({}, 'admin') }}
    </twig:Xutim:Admin:Button>

    <twig:Xutim:Admin:Button
        tag="a"
        variant="nav"
        data-turbo-frame="modal"
        href="{{ admin_path('admin_media_new') }}"
    >
        <twig:Xutim:Admin:Icon name="photo" class="me-1" />
        {{ 'New file'|trans({}, 'admin') }}
    </twig:Xutim:Admin:Button>
{% endblock %}

{% block body %}
    {% if folders is not empty %}
        <div class="d-flex align-items-center justify-content-between mb-2">
            <h2 class="h3 m-0">
                {{ 'Folders'|trans({}, 'admin') }}
            </h2>
        </div>
    {% endif %}

    <div
        class="row row-cards row-cols-lg-6 g-3 row-cols-md-4 row-cols-sm-3 row-cols-2 mb-4"
        id="media-folder-list"
    >
        {% for folder in folders %}
            {% set childrenCnt = folder.children|length %}
            {% set filesCnt = folder.files|length %}
            <div
                class="col"
                data-controller="drop-target"
                data-drop-target-id-value="{{ folder.id }}"
                data-drop-target-move-url-value="{{ path('admin_media_move_file_to_folder') }}"
                data-action="dragover->drop-target#over dragleave->drop-target#leave drop->drop-target#drop"
            >
                <a
                    class="card card-link"
                    href="{{ admin_path('admin_media_list', {id: folder.id}) }}"
                    data-drop-target-target="folderCard"
                >
                    <div
                        class="card-body d-flex align-items-center gap-2"
                        data-drop-target-target="folderCard"
                    >
                        <twig:Xutim:Admin:Icon name="folder" />
                        <div class="flex-fill">
                            <div class="fw-medium text-truncate">
                                {{ folder.name }}
                            </div>
                            <div class="text-secondary small">
                                {{ childrenCnt|default(0) }}
                                {{ 'folders'|trans({}, 'admin') }},
                                {{ filesCnt|default(0) }}
                                {{ 'files'|trans({}, 'admin') }}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        {% endfor %}
        <div class="col">
            <twig:Xutim:Admin:Button
                tag="a"
                variant="card-link"
                style="border-style: dashed"
                data-turbo-frame="modal"
                href="{{ admin_path('admin_media_folder_new', {id: currentFolder.id|default(null)}) }}"
            >
                <div
                    class="card-body d-flex align-items-center gap-2 text-black text-opacity-25"
                    data-drop-target-target="folderCard"
                >
                    <twig:Xutim:Admin:Icon name="plus" />
                    <div class="flex-fill">
                        <div class="fw-medium text-truncate">
                            {{ 'New folder'|trans({}, 'admin') }}
                        </div>
                    </div>
                </div>
            </twig:Xutim:Admin:Button>
        </div>
    </div>

    {% if files is not empty %}
        <div class="d-flex align-items-center justify-content-between mb-2">
            <h2 class="h3 m-0">
                {{ 'Files'|trans({}, 'admin') }}
            </h2>
        </div>
    {% endif %}
    <div
        class="row row-cards row-cols-lg-6 g-3 row-cols-md-4 row-cols-sm-3 row-cols-2"
        id="media-list"
    >
        {% for file in files %}
            {{ include('@XutimCore/admin/media/_row.html.twig') }}
        {% endfor %}
    </div>
    <div class="d-flex justify-content-center mt-4">
        {% set pages = files.NbPages %}
        {% if pages > 1 %}
            {% if files.currentPage - 3 > 0 %}
                <span class="text-black p-2 px-3 inline-block rounded-1">
                    ...
                </span>
            {% endif %}
            {% if files.currentPage - 2 > 0 %}
                <a
                    href="{{ admin_path('admin_media_list', {searchTerm: app.request.get('searchTerm'), page: files.currentPage - 2}) }}"
                    class="text-black p-2 px-3 inline-block rounded-1"
                >
                    {{ files.currentPage - 2 }}
                </a>
            {% endif %}
            {% if files.currentPage - 1 > 0 %}
                <a
                    href="{{ admin_path('admin_media_list', {searchTerm: app.request.get('searchTerm'), page: files.currentPage - 1}) }}"
                    class="text-black p-2 px-3 inline-block rounded-1"
                >
                    {{ files.currentPage - 1 }}
                </a>
            {% endif %}
            <a
                href="{{ admin_path('admin_media_list', {searchTerm: app.request.get('searchTerm'), page: files.currentPage}) }}"
                disabled="disabled"
                class="bg-gray-200 text-black p-2 px-3 inline-block rounded-1"
            >
                {{ files.currentPage }}
            </a>
            {% if files.currentPage + 1 <= pages %}
                <a
                    href="{{ admin_path('admin_media_list', {searchTerm: app.request.get('searchTerm'), page: files.currentPage + 1}) }}"
                    class="text-black p-2 px-3 inline-block rounded-1"
                >
                    {{ files.currentPage + 1 }}
                </a>
            {% endif %}
            {% if files.currentPage + 2 <= pages %}
                <a
                    href="{{ admin_path('admin_media_list', {searchTerm: app.request.get('searchTerm'), page: files.currentPage + 2}) }}"
                    class="text-black p-2 px-3 inline-block rounded-1"
                >
                    {{ files.currentPage + 2 }}
                </a>
            {% endif %}

            {% if files.currentPage + 3 <= pages %}
                <span class="text-black p-2 px-3 inline-block rounded-1">
                    ...
                </span>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}
