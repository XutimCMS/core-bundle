{% macro render_list(pages, ids, selectedId, openIds, canEdit,
    transEdit, transNewPage, transNewArticle, transMoveUp, transMoveDown
) %}
    {% import '@XutimCore/admin/common/icons.html.twig' as icons %}
    {% for id in ids %}
        {% set node = pages[id] %}
        {% set page = node.page %}
        {% set translation = node.translation %}
        {% set hasChildren = node.children is not empty %}
        {% set isSelected = selectedId and selectedId == id %}
        {% set opened = openIds is defined and openIds[id] is defined %}

        <li class="my-2 ms-3{{ isSelected ? ' bg-yellow-lt' : '' }}">
            {% if not hasChildren %}
                {{ icons.icon('chevron-down-left', 'text-black w-3 h-3') }}
                {{ _self.line(page, translation, isSelected, false, false, canEdit,
                    transEdit, transNewPage, transNewArticle, transMoveUp, transMoveDown) }}
            {% else %}
                <details{{ opened ? ' open="open"' : '' }} class="text-black">
                    <summary class="ms-2{{ isSelected ? ' fw-bold' : '' }}">
                        {{ _self.line(page, translation, isSelected, loop.first, loop.last, canEdit,
                            transEdit, transNewPage, transNewArticle, transMoveUp, transMoveDown) }}
                    </summary>
                    <ul class="list-unstyled">
                        {{ _self.render_list(pages, node.children, selectedId, openIds, canEdit,
                            transEdit, transNewPage, transNewArticle, transMoveUp, transMoveDown) }}
                    </ul>
                </details>
            {% endif %}
        </li>
    {% endfor %}
{% endmacro %}

{% macro line(page, translation, isSelected, first, last, canEdit,
    transEdit, transNewPage, transNewArticle, transMoveUp, transMoveDown
) %}
    {% import '@XutimCore/admin/common/translatable.html.twig' as translatable %}
    {% import '@XutimCore/admin/common/icons.html.twig' as icons %}
    <span class="me-1"></span>
    {{ translatable.languageBadge(translation) }}

    <a href="{{ admin_path('admin_page_list', {id: page.id}) }}">
        <span class="text-black{{ isSelected ? ' fw-bold' : '' }}">
            {{ translation.title }}
        </span>
    </a>

    {% if canEdit %}
        <div class="dropdown float-end">
            <a href="#" class="link-secondary" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                {{ icons.icon('dots', 'w-3 h-3') }}
            </a>
            <div class="dropdown-menu dropdown-menu-end">
                <a class="dropdown-item" href="{{ admin_path('admin_page_edit', {id: page.id}) }}">
                    {{ icons.icon('edit', 'me-2 w-3 h-3') }} {{ transEdit }}
                </a>

                <div class="dropdown-divider"></div>

                <a class="dropdown-item" href="{{ admin_path('admin_page_new', {id: page.id}) }}">
                    {{ icons.icon('folder', 'me-2 w-3 h-3') }} {{ transNewPage }}
                </a>

                <a class="dropdown-item" href="{{ admin_path('admin_article_new', {id: page.id}) }}">
                    {{ icons.icon('article', 'me-2 w-3 h-3') }} {{ transNewArticle }}
                </a>

              {% if not first or not last %}
                  <div class="dropdown-divider"></div>
                  {% if not first %}
                      <a class="dropdown-item" href="{{ admin_path('admin_page_move', {id: page.id, dir: 'up'}) }}">
                          {{ icons.icon('arrow-up', 'me-2 w-3 h-3') }} {{ transMoveUp }}
                      </a>
                  {% endif %}
                  {% if not last %}
                      <a class="dropdown-item" href="{{ admin_path('admin_page_move', {id: page.id, dir: 'down'}) }}">
                          {{ icons.icon('arrow-down', 'me-2 w-3 h-3') }} {{ transMoveDown }}
                      </a>
                  {% endif %}
              {% endif %}
            </div>
        </div>
    {% endif %}
{% endmacro %}
