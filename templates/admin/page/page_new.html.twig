{% extends '@XutimCore/admin/base.html.twig' %}
{% import '@XutimCore/admin/common/forms.html.twig' as forms %}

{% block pageTitle %}{{ 'New page'|trans({}, 'admin')|capitalize }}{%
    endblock
%}

{% block breadcrumbHeader %}
    {% if page is defined and page %}
        <twig:Xutim:Admin:BreadcrumbsPage :page="page" />
    {% else %}
        <twig:Xutim:Admin:Breadcrumbs>
            <li class="breadcrumb-item">New Page</li>
        </twig:Xutim:Admin:Breadcrumbs>
    {% endif %}
{% endblock %}

{% block body %}
    <div class="card">
        <div class="card-body">
            <turbo-frame id="editorjs-frame">
                {{
                    form_start(form, {
                        attr: {
                            id: form.vars.id,
                            'data-controller': 'editorjs-form slug-generator',
                            'data-editorjs-form-block-codes-value': fetch_block_codes()|json_encode,
                            'data-editorjs-form-tags-value': fetch_tags()|json_encode,
                            'data-editorjs-form-fetch-files-url-value': admin_path('admin_json_file_list'),
                            'data-editorjs-form-fetch-all-files-url-value': admin_path('admin_json_file_all_list'),
                            'data-editorjs-form-fetch-file-url-value': admin_path('admin_json_file_show', {id: ':id:'}),
                            'data-editorjs-form-fetch-images-url-value': admin_path('admin_json_image_list'),
                            'data-editorjs-form-page-ids-url-value': admin_path('admin_json_page_list'),
                            'data-editorjs-form-article-ids-url-value': admin_path('admin_json_article_list'),
                            'data-editorjs-form-tag-ids-url-value': admin_path('admin_json_tag_list'),
                            'data-editorjs-form-fetch-anchor-snippets-url-value': admin_path('admin_json_snippet_list', {type: 'anchor'}),
                            'data-slug-generator-url-value': admin_path('admin_json_content_translation_generate_slug'),
                            'data-slug-generator-enabled-value': page is defined ? 'false' : 'true',
                        },
                    })
                }}

                <div class="row g-6">
                    <div class="col-sm-6">
                        {{ form_row(form.preTitle) }}
                        {{
                            form_row(form.title, {
                                attr: {
                                    'data-action': 'input->slug-generator#fetchAndReplaceSlugOnTitle',
                                    'data-slug-generator-target': 'titleField',
                                },
                            })
                        }}
                        {{ form_row(form.subTitle) }}
                        {{ form_label(form.slug) }}
                        <div class="input-group mb-3">
                            {{
                                form_widget(form.slug, {
                                    attr: {
                                        'data-slug-generator-target': 'slugField',
                                    },
                                })
                            }}
                            {%
                                if is_granted(constant('Xutim\\SecurityBundle\\Security\\UserRoles::ROLE_EDITOR'))
                            %}
                                <twig:Xutim:Admin:Button
                                    variant="default"
                                    class="pe-1"
                                    type="button"
                                    id="slug-unblock"
                                    data-action="click->slug-generator#unblockSlugField"
                                >
                                    <twig:Xutim:Admin:Icon name="lock" />
                                </twig:Xutim:Admin:Button>
                            {% endif %}

                            {{ form_errors(form.slug) }}
                        </div>

                        {{ form_help(form.slug) }}

                        {{
                            form_row(form.locale, {
                                attr: {
                                    'data-action': 'change->slug-generator#fetchAndReplaceSlugOnLocale',
                                    'data-slug-generator-target': 'localeField',
                                },
                            })
                        }}

                        {{
                            form_row(form.parent, {
                                attr: {
                                    'data-controller': 'tom-select',
                                },
                            })
                        }}

                        {{ form_row(form.description) }}
                    </div>

                    <div class="col-sm-6">
                        {{ form_label(form.featuredImage) }}
                        <div
                            data-controller="featured-image"
                            data-featured-image-url-value="{{ admin_path('admin_json_image_list') }}"
                            class="cursor-pointer mb-3"
                        >
                            <div
                                class="media-container-extended d-flex justify-content-center align-items-center"
                                data-action="click->featured-image#openModal"
                            >
                                <div
                                    class="featured-image-dropzone"
                                    data-featured-image-target="dropzone"
                                >
                                    {% if form.featuredImage.vars.value %}
                                        <img
                                            src="{{ path('file_show', {id: form.featuredImage.vars.value, extension: 'image'}) }}"
                                            alt="Featured Image"
                                            style="max-width: auto; max-height: 300px"
                                            class="p-1"
                                        />
                                    {% else %}
                                        {{
                                            'Click to select a featured image'|trans({}, 'admin')
                                        }}
                                    {% endif %}
                                </div>
                                {{
                                    form_widget(form.featuredImage, {
                                        attr: {
                                            'data-featured-image-target': 'imageInput',
                                        },
                                    })
                                }}
                            </div>

                            <div
                                class="modal fade"
                                tabindex="-1"
                                role="dialog"
                                data-featured-image-target="modal"
                            >
                                <div
                                    class="modal-dialog modal-lg"
                                    role="document"
                                >
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">
                                                {{
                                                    'Select Featured Image'|trans({}, 'admin')
                                                }}
                                            </h5>
                                            <button
                                                type="button"
                                                class="btn-close"
                                                data-bs-dismiss="modal"
                                                aria-label="{{ 'Close'|trans({}, 'admin') }}"
                                            >
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div
                                                class="row g-3"
                                                data-featured-image-target="imageGallery"
                                            >
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button
                                                type="button"
                                                class="btn btn-secondary"
                                                data-bs-dismiss="modal"
                                            >
                                                {{ 'Close'|trans({}, 'admin') }}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{ form_row(form.layout) }}
                    </div>
                </div>

                <div class="mb-3">
                    <label for="article_translation_content" class="form-label">
                        Content
                    </label>
                    <div data-editorjs-form-target="editorHolder"></div>
                </div>
                {{
                    form_widget(form.content, {
                        attr: {
                            'data-editorjs-form-target': 'contentInput',
                        },
                    })
                }}

                <div class="mb-3">
                    <twig:Xutim:Admin:Button
                        type="submit"
                        variant="primary"
                        id="article_translation_submit"
                        form="{{ form.vars.id }}"
                        disabled="{{ form.vars.disabled }}"
                        data-action="click->editorjs-form#save:prevent"
                    >
                        {{ 'submit'|trans({}, 'admin') }}
                    </twig:Xutim:Admin:Button>
                </div>
                {{ form_row(form._token) }}
                {{ form_end(form, {render_rest: false}) }}
            </turbo-frame>
        </div>
    </div>
{% endblock %}
