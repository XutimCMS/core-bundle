{% import '@XutimCore/admin/common/translatable.html.twig' as translatable %}

{% macro modalDialogPage(id, status, confirmActionLabel, iconName) %}
    <twig:Xutim:Admin:ModalDialog
        class="btn-link text-{{ status.colorClass }} p-0"
        modalDialogColor="{{ status.colorClass }}"
        action="{{ admin_path('admin_publication_status_edit', {id: id, status: status.value}) }}"
        confirmActionLabel="{{ confirmActionLabel }}"
    >
        <twig:Xutim:Admin:Icon name="{{ iconName }}" plain="true" />
    </twig:Xutim:Admin:ModalDialog>
{% endmacro %}

<div class="mb-3">
    {% if not translation %}
        <twig:Xutim:Admin:SidebarSection>
            <twig:Xutim:Admin:SidebarItem>
                <twig:block name="content">
                    {{
                        '%locale% translation doesn\'t exist yet.'|trans({'%locale%': content_context_language()|language_name}, 'admin')
                    }}
                </twig:block>
            </twig:Xutim:Admin:SidebarItem>
            {% if app.current_route != 'admin_article_edit' %}
                <twig:Xutim:Admin:SidebarItem>
                    <twig:block name="content">
                        <twig:Xutim:Admin:Button
                            variant="primary"
                            href="{{ admin_path('admin_article_edit', {id: article.id}) }}"
                            tag="a"
                        >
                            {{ 'Add translation'|trans({}, 'admin') }}
                        </twig:Xutim:Admin:Button>
                    </twig:block>
                </twig:Xutim:Admin:SidebarItem>
            {% endif %}
        </twig:Xutim:Admin:SidebarSection>
    {% endif %}
    {% if translation %}
        <twig:Xutim:Admin:SidebarSection>
            {{
                include('@XutimCore/admin/article/_publication_status_sidebar_item.html.twig',
            )
            }}

            {%
                if referenceHasChanged|default(false) and translation is defined and translation is not same as(null)
            %}
                <twig:Xutim:Admin:SidebarItem>
                    <a
                        href="{{ admin_path('admin_content_translation_revisions', {id: translation.id}) }}"
                        class="fw-bold"
                    >
                        {{
                            'New changes in reference translation'|trans({}, 'admin')
                        }}
                    </a>
                </twig:Xutim:Admin:SidebarItem>
            {% endif %}

            <twig:Xutim:Admin:SidebarItem>
                <twig:block name="header">
                    {{ 'layout'|trans({}, 'admin')|capitalize }}:
                </twig:block>
                <twig:block name="content">
                    <span id="article-layout-item">{{ article.layout }}</span>

                    <div
                        {% if article.layout is null %}
                            class="ms-auto"
                        {% endif %}
                    >
                        <twig:Xutim:Admin:Button
                            tag="a"
                            variant="link"
                            class="p-0"
                            data-turbo-frame="modal"
                            href="{{ admin_path('admin_article_layout_edit', {id: article.id}) }}"
                        >
                            <twig:Xutim:Admin:Icon name="edit" />
                        </twig:Xutim:Admin:Button>
                    </div>
                </twig:block>
            </twig:Xutim:Admin:SidebarItem>

            {{
                include('@XutimCore/admin/article/_tags_sidebar_item.html.twig')
            }}
            {{
                include('@XutimCore/admin/article/_featured_image_sidebar_item.html.twig')
            }}
            {{
                include('@XutimCore/admin/article/_published_sidebar_item.html.twig')
            }}

            <twig:Xutim:Admin:SidebarItem>
                <twig:block name="header">
                    {{ 'author'|trans({}, 'admin')|capitalize }}:
                </twig:block>
                <twig:block name="content">
                    {% if lastRevision %}
                        {{ lastRevision.userIdentifier }}
                    {% else %}
                        {{ 'unknown'|trans({}, 'admin') }}
                    {% endif %}
                </twig:block>
            </twig:Xutim:Admin:SidebarItem>

            {% set effectiveUpdatedAt = (draft is defined and draft and draft.updatedAt > translation.updatedAt) ? draft.updatedAt : translation.updatedAt %}
            <twig:Xutim:Admin:SidebarItem>
                <twig:block name="header">
                    {{ 'updated at'|trans({}, 'admin')|capitalize }}:
                </twig:block>
                <twig:block name="content">
                    <span
                        title="{{ effectiveUpdatedAt|date('d/m/Y H:i') }}"
                        data-controller="tooltip"
                    >
                        {{ effectiveUpdatedAt|time_ago }}
                    </span>
                </twig:block>
            </twig:Xutim:Admin:SidebarItem>

            <twig:Xutim:Admin:SidebarItem>
                <twig:block name="header">
                    {{ 'revisions'|trans({}, 'admin')|capitalize }}:
                </twig:block>
                <twig:block name="content">
                    <a
                        href="{{ admin_path('admin_content_translation_revisions', {id: translation.id}) }}"
                    >
                        {{ revisionsCount }}
                    </a>
                </twig:block>
            </twig:Xutim:Admin:SidebarItem>
        </twig:Xutim:Admin:SidebarSection>

        {% if xutim_analytics_enabled() %}
            {% set analyticsPath = path('content_translation_show', {
                slug: translation.slug,
                _locale: translation.locale,
            }) %}
            <turbo-frame
                id="analytics-sidebar"
                src="{{ path('admin_analytics_sidebar_widget', {path: analyticsPath}) }}"
                loading="lazy"
            >
                <twig:Xutim:Admin:SidebarSection>
                    <twig:Xutim:Admin:SidebarItem>
                        <twig:block name="content">
                            <span class="text-muted small">{{ 'Loading analytics...'|trans({}, 'admin') }}</span>
                        </twig:block>
                    </twig:Xutim:Admin:SidebarItem>
                </twig:Xutim:Admin:SidebarSection>
            </turbo-frame>
        {% endif %}

        <twig:Xutim:Admin:SidebarSection>
            <twig:Xutim:Admin:SidebarItem>
                <twig:block name="content">
                    <div class="btn-group">
                        {% if translation.status.canBeArchived %}
                            {%
                                set archiveStatus = constant('Xutim\\CoreBundle\\Entity\\PublicationStatus::Archived')
                            %}
                            <twig:Xutim:Admin:ModalDialog
                                class="btn btn-outline-{{ archiveStatus.colorClass }}"
                                modalDialogColor="{{ archiveStatus.colorClass }}"
                                action="{{ admin_path('admin_publication_status_edit', {id: translation.id, status: archiveStatus.value}) }}"
                                confirmActionLabel="{{ 'archive'|trans({}, 'admin')|capitalize }}"
                            >
                                <twig:Xutim:Admin:Icon name="archive" />
                                {{ 'archive'|trans({}, 'admin')|capitalize }}
                            </twig:Xutim:Admin:ModalDialog>
                        {% endif %}
                        <twig:Xutim:Admin:ModalDialog
                            class="btn btn-outline-danger"
                            modalDialogColor="danger"
                            action="{{ admin_path('admin_content_translation_delete', {id: translation.id}) }}"
                            confirmActionLabel="{{ 'delete'|trans({}, 'admin')|capitalize }}"
                        >
                            <twig:Xutim:Admin:Icon name="trash" />
                            {{ 'delete'|trans({}, 'admin')|capitalize }}
                        </twig:Xutim:Admin:ModalDialog>
                    </div>
                </twig:block>
            </twig:Xutim:Admin:SidebarItem>
        </twig:Xutim:Admin:SidebarSection>
    {% endif %}
</div>
