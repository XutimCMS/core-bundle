{% extends '@XutimCore/admin/base.html.twig' %}
{% import '@XutimCore/admin/common/badges.html.twig' as badges %}

{% block title %}
    {{ article.defaultTranslation.title }}
{% endblock %}

{% block pageTitle %}
    <twig:Xutim:Admin:Icon name="article" />
    {{ article.defaultTranslation.title }}
{% endblock %}

{% block breadcrumbHeader %}
    <twig:Xutim:Admin:BreadcrumbsArticle :article="article" />
{% endblock %}

{% block publicLink %}
    <twig:Xutim:Admin:PublicPageLink :contentTranslation="translation" />
{% endblock %}

{% block pageMenu %}
    {% if translation is not same as(null) %}
        <twig:Xutim:Admin:Button
            tag="a"
            variant="nav"
            href="{{ admin_path('admin_content_translation_revisions', {id: translation.id}) }}"
        >
            <twig:Xutim:Admin:Icon name="history" class="me-1" />
            History
        </twig:Xutim:Admin:Button>
    {% endif %}

    <twig:Xutim:Admin:Button
        tag="a"
        variant="nav"
        href="{{ admin_path('admin_article_show', {id: article.id}) }}"
    >
        <twig:Xutim:Admin:Icon name="search" class="me-1" />
        Show
    </twig:Xutim:Admin:Button>

    <twig:Xutim:Admin:Button
        tag="button"
        id="sidebar-toggle"
        variant="nav"
    >
        <twig:Xutim:Admin:Icon name="layout-sidebar-right" class="me-1" />
        Sidebar
    </twig:Xutim:Admin:Button>
{% endblock %}

{% block languageBar %}
    <twig:Xutim:Admin:LanguageContextBar
        :entity="article"
        class="d-flex justify-content-end align-items-center mb-2"
    />
{% endblock %}

{% block sidebar %}
    <twig:Xutim:Admin:Sidebar :title="">
        <twig:block name="header">
            <twig:Xutim:Admin:SidebarTabs>
                <twig:Xutim:Admin:SidebarTab target="general-tab">
                    <twig:Xutim:Admin:Button
                        variant="tab"
                        type="a"
                        class="active"
                        data-bs-toggle="tab"
                        href="#general-tab"
                        role="tab"
                        aria-controls="general-tab"
                        aria-selected="true"
                    >
                        General
                    </twig:Xutim:Admin:Button>
                </twig:Xutim:Admin:SidebarTab>
            </twig:Xutim:Admin:SidebarTabs>
        </twig:block>
        <twig:block name="content">
            <div class="tab-content">
                <div id="general-tab" class="tab-pane active" role="tabpanel">
                    {{
                        include('@XutimCore/admin/article/_article_sidebar.html.twig')
                    }}
                </div>
            </div>
        </twig:block>
    </twig:Xutim:Admin:Sidebar>
{% endblock %}

{% block body %}
    {% if translation is not null and translation.published %}
    <div data-controller="editing-presence"
         data-editing-presence-heartbeat-url-value="{{ admin_path('admin_content_translation_heartbeat', {id: translation.id}) }}"
         data-editing-presence-stop-url-value="{{ admin_path('admin_content_translation_stop_editing', {id: translation.id}) }}"
         data-editing-presence-mercure-topic-value="{{ mercure('content-translation/' ~ translation.id ~ '/presence') }}"
         data-editing-presence-current-user-id-value="{{ app.user.id }}">
        {{ include('@XutimCore/admin/content_translation/_editing_presence_banner.html.twig') }}
        {{ include('@XutimCore/admin/content_translation/_draft_changed_banner.html.twig') }}
    </div>
    {% endif %}
    {{ include('@XutimCore/admin/content_draft/_draft_banner.html.twig') }}
    <div
        data-controller="split-view"
        data-split-view-target="root"
        data-split-view-reference-url-value="{{ admin_path('admin_json_content_translation_show', {id: article.defaultTranslation.id}) }}"
        data-split-view-current-translation-id-value="{{ translation ? translation.id : '' }}"
        class="card mb-3"
        data-split-view-block-codes-value="{{ fetch_block_codes()|json_encode }}"
        data-split-view-tags-value="{{ fetch_tags()|json_encode }}"
        data-split-view-fetch-files-url-value="{{ admin_path('admin_json_file_list') }}"
        data-split-view-fetch-all-files-url-value="{{ admin_path('admin_json_file_all_list') }}"
        data-split-view-fetch-file-url-value="{{ admin_path('admin_json_file_show', {id: ':id:'}) }}"
        data-split-view-fetch-images-url-value="{{ admin_path('admin_json_image_list') }}"
        data-split-view-page-ids-url-value="{{ admin_path('admin_json_page_list') }}"
        data-split-view-article-ids-url-value="{{ admin_path('admin_json_article_list') }}"
        data-split-view-tag-ids-url-value="{{ admin_path('admin_json_tag_list') }}"
        data-split-view-fetch-anchor-snippets-url-value="{{ admin_path('admin_json_snippet_list', {type: 'anchor'}) }}"
    >
        <div class="card-header d-flex align-items-center justify-content-between">
            <div class="fw-bold">
                {% if translation is null %}
                    Translate into {{ content_context_language()|upper }}
                {% else %}
                    {{ translation.locale|upper }} translation
                {% endif %}
            </div>

            <div class="d-flex align-items-center gap-2">
                <select
                    class="form-select form-select-sm"
                    data-split-view-target="localeSelect"
                    data-action="change->split-view#loadReference"
                    hidden
                >
                    {% for tr in article.translations %}
                        <option
                            value="{{ admin_path('admin_json_content_translation_show', {id: tr.id}) }}"
                            {% if article.defaultTranslation.id == tr.id %}
                                selected
                            {% endif %}
                        >
                            {{ tr.locale|locale_name }}{%
                                if article.defaultTranslation.id == tr.id
                            %}
                                â€” {{
                                    'reference for translations'|trans({}, 'admin')
                                }}{% endif %}
                        </option>
                    {% endfor %}
                </select>

                <twig:Xutim:Admin:Button
                    tag="button"
                    variant="default"
                    class="btn-sm"
                    data-split-view-target="localeSelectClipboard"
                    data-action="split-view#copyAllBlocks"
                    title="Copy all blocks"
                    hidden
                >
                    <twig:ux:icon name="tabler:clipboard" class="w-3 h-3" />
                </twig:Xutim:Admin:Button>

                <twig:Xutim:Admin:Button
                    tag="button"
                    variant="default"
                    class="text-dark d-flex align-items-center text-nowrap btn-sm"
                    data-action="split-view#toggle"
                    title="Toggle split view"
                >
                    <span
                        data-split-view-target="iconOn"
                        class="d-flex align-items-center"
                    >
                        <twig:ux:icon
                            name="tabler:columns-2"
                            class="w-3 h-3 me-1"
                        />
                        Split view
                    </span>

                    <span
                        data-split-view-target="iconOff"
                        class="d-none d-flex align-items-center"
                    >
                        <twig:ux:icon
                            name="tabler:columns-1"
                            class="w-3 h-3 me-1"
                        />
                        Single view
                    </span>
                </twig:Xutim:Admin:Button>
            </div>
        </div>

        <div class="card-body p-0">
            <div class="row g-0" data-split-view-target="container">
                <div class="col-12 p-4" data-split-view-target="left">
                    {{
                        include('@XutimCore/admin/content_translation/_form.html.twig')
                    }}
                    {%
                        if not translation and article.translations|length > 0 and form.slug.vars.value is empty and form.vars.disabled == false
                    %}
                        {{
                            include('@XutimCore/admin/article_translation/new_translation_modal.html.twig', {article: article})
                        }}
                    {% endif %}
                </div>

                <div
                    class="col-12 col-lg-6 border-start d-none p-4"
                    data-split-view-target="right"
                >
                    <div class="mb-3">
                        <label class="form-label">Intro title</label>
                        <input
                            type="text"
                            class="form-control text-bg-light"
                            readonly
                            value="{{ article.defaultTranslation.pretitle }}"
                            data-split-view-target="metaPretitle"
                        />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input
                            type="text"
                            class="form-control text-bg-light"
                            readonly
                            value="{{ article.defaultTranslation.title }}"
                            data-split-view-target="metaTitle"
                        />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Subtitle</label>
                        <input
                            type="text"
                            class="form-control text-bg-light"
                            readonly
                            value="{{ article.defaultTranslation.subtitle }}"
                            data-split-view-target="metaSubtitle"
                        />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Slug</label>
                        <input
                            type="text"
                            class="form-control text-bg-light"
                            readonly
                            value="{{ article.defaultTranslation.slug }}"
                            data-split-view-target="metaSlug"
                        />
                    </div>

                    <div class="mb-6">
                        <label class="form-label">Description</label>
                        <textarea
                            class="form-control text-bg-light"
                            rows="2"
                            readonly
                            data-split-view-target="metaDescription"
                        >{{ article.defaultTranslation.description|striptags }}</textarea>
                        <div
                            id="content_translation_description_help"
                            class="form-text mb-0 help-text"
                        >
                            &ensp;<br>
                            &ensp;
                        </div>
                    </div>

                    <div class="ms-4 mt-3">
                        <div
                            id="reference-editor"
                            data-split-view-target="reference"
                        >
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
