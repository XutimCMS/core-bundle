{% extends '@XutimCore/admin/base.html.twig' %}
{% import '@XutimCore/admin/common/badges.html.twig' as badges %}

{% block title %}
    {{ article.defaultTranslation.title }}
{% endblock %}

{% block pageTitle %}
    <twig:Xutim:Admin:Icon name="article" />
    {{ article.defaultTranslation.title }}
{% endblock %}

{% block breadcrumbHeader %}
    <twig:Xutim:Admin:BreadcrumbsArticle :article="article" />
{% endblock %}

{% block publicLink %}
    <twig:Xutim:Admin:PublicPageLink :contentTranslation="translation" />
{% endblock %}

{% block pageMenu %}
    {% if translation is not same as(null) %}
        <twig:Xutim:Admin:Button
            tag="a"
            variant="nav"
            href="{{ admin_path('admin_content_translation_revisions', {id: translation.id}) }}"
        >
            <twig:Xutim:Admin:Icon name="history" class="me-1" />
            History
        </twig:Xutim:Admin:Button>
    {% endif %}

    <twig:Xutim:Admin:Button
        tag="a"
        variant="nav"
        href="{{ admin_path('admin_article_show', {id: article.id}) }}"
    >
        <twig:Xutim:Admin:Icon name="search" class="me-1" />
        Show
    </twig:Xutim:Admin:Button>

    <twig:Xutim:Admin:Button
        tag="button"
        id="sidebar-toggle"
        variant="nav"
    >
        <twig:Xutim:Admin:Icon name="layout-sidebar-right" class="me-1" />
        Sidebar
    </twig:Xutim:Admin:Button>
{% endblock %}

{% block languageBar %}
    <twig:Xutim:Admin:LanguageContextBar
        :entity="article"
        class="d-flex justify-content-end align-items-center mb-2"
    />
{% endblock %}

{% block sidebar %}
    <twig:Xutim:Admin:Sidebar :title="">
        <twig:block name="header">
            <twig:Xutim:Admin:SidebarTabs>
                <twig:Xutim:Admin:SidebarTab target="general-tab">
                    <twig:Xutim:Admin:Button
                        variant="tab"
                        type="a"
                        class="active"
                        data-bs-toggle="tab"
                        href="#general-tab"
                        role="tab"
                        aria-controls="general-tab"
                        aria-selected="true"
                    >
                        General
                    </twig:Xutim:Admin:Button>
                </twig:Xutim:Admin:SidebarTab>
                <twig:Xutim:Admin:SidebarTab target="translation-reference-tab">
                    <twig:Xutim:Admin:Button
                        variant="tab"
                        type="a"
                        data-bs-toggle="tab"
                        href="#translation-reference-tab"
                        role="tab"
                        aria-controls="translation-reference-tab"
                        aria-selected="false"
                    >
                        Translation Reference
                    </twig:Xutim:Admin:Button>
                </twig:Xutim:Admin:SidebarTab>
            </twig:Xutim:Admin:SidebarTabs>
        </twig:block>
        <twig:block name="content">
            <div class="tab-content">
                <div id="general-tab" class="tab-pane active" role="tabpanel">
                    {{
                        include('@XutimCore/admin/article/_article_sidebar.html.twig')
                    }}
                </div>
                <div
                    id="translation-reference-tab"
                    class="tab-pane m-4"
                    role="tabpanel"
                >
                    {{
                        include('@XutimCore/admin/article/article_translation_show.html.twig', {article: article, translation: article.defaultTranslation})
                    }}
                </div>
            </div>
        </twig:block>
    </twig:Xutim:Admin:Sidebar>
{% endblock %}

{% block body %}
    <div class="card mb-3">
        <div class="card-body p-0">
            <div class="tab-content">
                <div id="main-form" class="tab-pane active show p-4">
                    {{
                        include('@XutimCore/admin/content_translation/_form.html.twig')
                    }}
                    {%
                        if not translation and article.translations|length > 0 and form.slug.vars.value is empty and form.vars.disabled == false
                    %}
                        {{
                            include('@XutimCore/admin/article_translation/new_translation_modal.html.twig', {article: article})
                        }}
                    {% endif %}
                </div>
                <div id="translations" class="tab-pane p-0">
                    <div class="table-responsive">
                        <table class="table table-vcenter card-table">
                            <thead>
                                <tr>
                                    <th
                                        class="w-6"
                                        title="Status"
                                        data-controller="tooltip"
                                    >
                                        S
                                    </th>
                                    <th
                                        class="w-1"
                                        title="Translation reference"
                                        data-controller="tooltip"
                                    >
                                        T
                                    </th>
                                    <th>{{ 'title'|trans({}, 'admin') }}</th>
                                    <th>{{ 'language'|trans({}, 'admin') }}</th>
                                    <th>
                                        {{
                                            'status actions'|trans({}, 'admin')
                                        }}
                                    </th>
                                    <th class="w-15 text-end">
                                        {{ 'actions'|trans({}, 'admin') }}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for translation in article.translations %}
                                    <tr>
                                        <td class="w-6">
                                            <twig:Xutim:Admin:Button
                                                variant="default"
                                                type="button"
                                                class="btn-link p-0 border-0"
                                                data-bs-placement="bottom"
                                                data-controller="popover"
                                                data-bs-toggle="popover"
                                                data-bs-selector="#changeStatus"
                                            >
                                                {%
                                                    import '@XutimCore/admin/common/badges.html.twig' as badges
                                                %}
                                                {{
                                                    badges.publicationStatusBadge(translation)
                                                }}
                                            </twig:Xutim:Admin:Button>
                                        </td>
                                        <td
                                            title="Translation reference"
                                            data-controller="tooltip"
                                        >
                                            {%
                                                if article.defaultTranslation.id == translation.id
                                            %}
                                                <span
                                                    class="fw-bold text-green"
                                                >
                                                    <twig:Xutim:Admin:Icon
                                                        name="language"
                                                    />
                                                </span>
                                            {% else %}
                                                <twig:Xutim:Admin:ModalDialog
                                                    class="btn-link d-sm-inline-block px-0 border-0"
                                                    action="{{ admin_path('admin_article_mark_default_translation', {id: article.id, transId: translation.id}) }}"
                                                    confirmActionLabel="{{ 'action.mark_as_default'|trans({}, 'admin')|capitalize }}"
                                                >
                                                    <span
                                                        class="badge text-bg-secondary"
                                                    ></span>
                                                </twig:Xutim:Admin:ModalDialog>
                                            {% endif %}
                                        </td>
                                        <td class="text-muted">
                                            <a
                                                href="{{ admin_path('admin_content_translation_edit', {id: translation.id}) }}"
                                                class="btn-link"
                                                aria-label="{{ 'edit'|trans({}, 'admin') }}"
                                            >
                                                {{ translation.title }}
                                            </a>
                                            {%
                                                if article.defaultTranslation.id == translation.id
                                            %}
                                                ({{
                                                    'reference for translations'|trans({}, 'admin')
                                                }})
                                            {% endif %}
                                        </td>
                                        <td class="text-muted">
                                            {{ translation.locale|locale_name }}
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                {%
                                                    if translation.status.canBeDrafted()
                                                %}
                                                    {{
                                                        _self.modalDialogPage(translation.id, constant('Xutim\\CoreBundle\\Entity\\PublicationStatus::Draft'), 'draft'|trans({}, 'admin')|capitalize, 'clipboard')
                                                    }}
                                                {% endif %}

                                                {%
                                                    if translation.status.canPublish
                                                %}
                                                    {{
                                                        _self.modalDialogPage(translation.id, constant('Xutim\\CoreBundle\\Entity\\PublicationStatus::Published'), 'publish'|trans({}, 'admin')|capitalize, 'cloud-upload')
                                                    }}
                                                {% endif %}

                                                {%
                                                    if translation.status.canSubmitForEvaluation
                                                %}
                                                    {{
                                                        _self.modalDialogPage(translation.id, constant('Xutim\\CoreBundle\\Entity\\PublicationStatus::Evaluation'), 'submit for evaluation'|trans({}, 'admin')|capitalize, 'refresh-alert')
                                                    }}
                                                {% endif %}

                                                {%
                                                    if translation.status.canBeArchived
                                                %}
                                                    {{
                                                        _self.modalDialogPage(translation.id, constant('Xutim\\CoreBundle\\Entity\\PublicationStatus::Archived'), 'archive'|trans({}, 'admin')|capitalize, 'archive')
                                                    }}
                                                {% endif %}

                                                <twig:Xutim:Admin:ModalDialog
                                                    class="btn-link text-danger p-0"
                                                    modalDialogColor="danger"
                                                    action="{{ admin_path('admin_publication_status_edit', {id: translation.id, status: 'archived'}) }}"
                                                    confirmActionLabel="{{ 'delete'|trans({}, 'admin')|capitalize }}"
                                                >
                                                    <twig:Xutim:Admin:Icon
                                                        name="trash"
                                                        plain="true"
                                                    />
                                                </twig:Xutim:Admin:ModalDialog>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="float-end">
                                                <div class="btn-group">
                                                    <twig:Xutim:Admin:Button
                                                        variant="link"
                                                        tag="a"
                                                        href="{{ path('content_translation_show', {_locale: translation.locale, slug: translation.slug}) }}"
                                                        class="mt-1"
                                                        aria-label="{{ 'Show on public page'|trans({}, 'admin') }}"
                                                        data-turbo="false"
                                                    >
                                                        <twig:Xutim:Admin:Icon
                                                            name="cloud-search"
                                                        />
                                                    </twig:Xutim:Admin:Button>

                                                    {%
                                                        if app.user.canTranslate(translation.locale)
                                                    %}
                                                        <a
                                                            href="{{ admin_path('admin_content_translation_edit', {id: translation.id}) }}"
                                                            class="btn-link mt-1"
                                                            aria-label="{{ 'edit'|trans({}, 'admin') }}"
                                                        >
                                                            <twig:Xutim:Admin:Icon
                                                                name="edit"
                                                            />
                                                        </a>

                                                        <a
                                                            href="{{ admin_path('admin_content_translation_revisions', {id: translation.id}) }}"
                                                            class="btn-link mt-1"
                                                            aria-label="{{ 'revisions'|trans({}, 'admin') }}"
                                                        >
                                                            <twig:Xutim:Admin:Icon
                                                                name="history"
                                                            />
                                                        </a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% macro modalDialogPage(id, status, confirmActionLabel, iconName) %}
    <twig:Xutim:Admin:ModalDialog
        class="btn-link text-{{ status.colorClass }} p-0"
        modalDialogColor="{{ status.colorClass }}"
        action="{{ admin_path('admin_publication_status_edit', {id: id, status: status.value}) }}"
        confirmActionLabel="{{ confirmActionLabel }}"
    >
        <twig:Xutim:Admin:Icon name="{{ iconName }}" plain="true" />
    </twig:Xutim:Admin:ModalDialog>
{% endmacro %}
